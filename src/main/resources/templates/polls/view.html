<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${poll.question}">Poll Question</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .poll-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
        }

        .poll-description {
            margin-bottom: 25px;
            color: #666;
        }

        .poll-option {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .poll-option:hover {
            background-color: #f8f9fa;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .option-results {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .progress {
            height: 20px;
            flex-grow: 1;
        }

        .votes-count {
            min-width: 80px;
            text-align: right;
            color: #666;
        }

        .voters-list {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .voters-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .voters-list li {
            display: inline-block;
            margin-right: 10px;
            padding: 2px 8px;
            background-color: #e9ecef;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .admin-controls {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .custom-checkbox .form-check-input,
        .custom-radio .form-check-input {
            width: 1.5em;
            height: 1.5em;
            margin-right: 10px;
        }

        .alert {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="container poll-container">
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <h1 class="mb-4" th:text="${poll.question}"></h1>
    <p class="poll-description" th:text="${poll.description}"></p>

    <div th:if="${poll.canVote}">
        <form th:action="@{/groups/{groupId}/polls/{id}/vote(groupId=${groupId}, id=${poll.id})}"
              th:object="${voteDTO}"
              method="post">
            <div th:each="option : ${poll.options}" class="poll-option">
                <label class="option-label">
                    <input th:if="${poll.multipleChoice}"
                           type="checkbox"
                           class="form-check-input"
                           th:value="${option.id}"
                           th:field="*{optionIds}"/>
                    <input th:unless="${poll.multipleChoice}"
                           type="radio"
                           class="form-check-input"
                           th:value="${option.id}"
                           th:field="*{optionIds}"/>
                    <span th:text="${option.text}"></span>
                </label>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Vote</button>
        </form>
    </div>

    <div th:unless="${poll.canVote}">
        <div th:each="option : ${poll.options}" class="poll-option">
            <div class="option-text" th:text="${option.text}"></div>
            <div class="option-results">
                <div class="progress">
                    <div class="progress-bar" role="progressbar"
                         th:style="'width: ' + ${option.percentage} + '%'"
                         th:text="${option.percentage + '%'}">
                    </div>
                </div>
                <span class="votes-count" th:text="${option.votesCount + ' votes'}"></span>
            </div>

            <div th:if="${!poll.anonymous && poll.totalVotes != null && poll.minimumVotesToShow != null && poll.totalVotes >= poll.minimumVotesToShow}"
                 class="voters-list">
                <span>Voters:</span>
                <ul>
                    <li th:each="voter : ${option.voters}"
                        th:text="${voter.username}"></li>
                </ul>
            </div>
        </div>

        <div class="mt-3 text-muted">
            Total votes: <span th:text="${poll.totalVotes}"></span>
        </div>
    </div>

    <div th:if="${poll.createdBy.id == #authentication.principal.id}" class="admin-controls">
        <a th:href="@{/groups/{groupId}/polls/{id}/edit(groupId=${groupId}, id=${poll.id})}"
           class="btn btn-outline-primary">Edit</a>
        <form th:action="@{/groups/{groupId}/polls/{id}/delete(groupId=${groupId}, id=${poll.id})}"
              method="post"
              style="display: inline;">
            <button type="submit" class="btn btn-outline-danger ms-2"
                    onclick="return confirm('Are you sure you want to delete this poll?')">
                Delete
            </button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Добавляем анимацию для progress bar
    document.addEventListener('DOMContentLoaded', function () {
        const progressBars = document.querySelectorAll('.progress-bar');
        setTimeout(() => {
            progressBars.forEach(bar => {
                bar.style.transition = 'width 1s ease-in-out';
                bar.style.width = bar.getAttribute('data-width');
            });
        }, 100);
    });
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title th:text="${poll.question}">Poll Question</title>-->
<!--</head>-->
<!--<body>-->
<!--<div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>-->
<!--<div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>-->

<!--<h1 th:text="${poll.question}"></h1>-->
<!--<p th:text="${poll.description}"></p>-->

<!--<div th:if="${poll.canVote}">-->
<!--    <form th:action="@{/polls/{id}/vote(id=${poll.id})}" th:object="${voteDTO}" method="post">-->
<!--        <div th:each="option : ${poll.options}">-->
<!--            <label>-->
<!--                <input th:if="${poll.multipleChoice}"-->
<!--                       type="checkbox"-->
<!--                       th:value="${option.id}"-->
<!--                       th:field="*{optionIds}"/>-->
<!--                <input th:unless="${poll.multipleChoice}"-->
<!--                       type="radio"-->
<!--                       th:value="${option.id}"-->
<!--                       th:field="*{optionIds}"/>-->
<!--                <span th:text="${option.text}"></span>-->
<!--            </label>-->
<!--        </div>-->
<!--        <button type="submit">Vote</button>-->
<!--    </form>-->
<!--</div>-->

<!--<div th:unless="${poll.canVote}">-->
<!--    <div th:each="option : ${poll.options}">-->
<!--        <div>-->
<!--            <span th:text="${option.text}"></span>-->
<!--            <span th:text="${option.votesCount}">votes</span>-->
<!--            <span th:text="${option.percentage + '%'}"></span>-->

<!--            <div th:if="${!poll.anonymous && poll.totalVotes >= poll.minimumVotesToShow}">-->
<!--                <span>Voters:</span>-->
<!--                <ul>-->
<!--                    <li th:each="voter : ${option.voters}"-->
<!--                        th:text="${voter.username}"></li>-->
<!--                </ul>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<div th:if="${poll.createdBy.id == #authentication.principal.id}">-->
<!--    <a th:href="@{/polls/{id}/edit(id=${poll.id})}" class="btn btn-primary">Edit</a>-->
<!--    <form th:action="@{/polls/{id}/delete(id=${poll.id})}" method="post" style="display: inline;">-->
<!--        <button type="submit" class="btn btn-danger"-->
<!--                onclick="return confirm('Are you sure you want to delete this poll?')">-->
<!--            Delete-->
<!--        </button>-->
<!--    </form>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->